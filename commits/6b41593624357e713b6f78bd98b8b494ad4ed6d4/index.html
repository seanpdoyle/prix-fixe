<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Internationalize application's text
</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <link href="../../stylesheets/syntax.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <details id="table-of-contents" class="page__history" open>
      <summary class="page__history-summary">
        Table of Contents
      </summary>
      <nav class="history">
        <a href="../../">prix-fixe</a>

          <a href="../1106e13e2568ee68f1528e4ac3e42070ad24dfc6/">[GENERATED] Initial Commit
</a>
          <a href="../65bf913763168f594a3873bcd9d0f6577602c986/">Elaborate on the project&#x27;s goals in the README
</a>
          <a href="../6d1482de076a391b14b055aba66413577d326997/">Un-comment remaining `Gemfile` dependencies
</a>
          <a href="../63ad27b47bf372894689ee4a57193581d016bea6/">Create `git-read` GitHub Action
</a>
          <a href="../286c87daff9c9edf5511dd9ed89d93cd4e0c300f/">Execute the Rails-generated `bin&#x2F;setup` script
</a>
          <a href="../2e3dde3c9b976dfddaae6337c54d8a51fe2a3330/">Add `UserSharesAMessageTest`
</a>
          <a href="../c95a48404a071a14bc8fdeef8f51cd77754ae572/">Add a failing system test
</a>
          <a href="../838b705249321b89cf4927c3fc35fd6181cea17b/">Declare `GET &quot;&#x2F;&quot;` route
</a>
          <a href="../d3e4903047dbba9e787aa06c7bbe1a357f4bb5ae/">Declare `NotesController`
</a>
          <a href="../d8f2fe09296fac464175c9e06f23ff8816211187/">Extend from `ApplicationController`
</a>
          <a href="../a437fd15990afc70f4afff57532ac3c89628014f/">Declare `app&#x2F;views&#x2F;notes&#x2F;index.html.erb`
</a>
          <a href="../bcfa4308c498ef9f47a671cf8fbae1b02dc9419a/">Render `&lt;a&gt;` containing `&quot;Share a Note&quot;`
</a>
          <a href="../2f6d61d65f27dd2ca87ffa86581a8c22d6fc5af8/">Link to `&quot;&#x2F;&quot;`
</a>
          <a href="../d3f9e315cc244b767afb23ddbedabaf27cdc5239/">Declare `GET &#x2F;notes&#x2F;new` route
</a>
          <a href="../b64199c63d296c4900a8ac78410371a846f1e885/">Declare `app&#x2F;views&#x2F;notes&#x2F;new.html.erb` view
</a>
          <a href="../f0164b911d0955887a6c0033097e3a676a9c4c5c/">Render `&lt;label&gt;` and `&lt;textarea&gt;`
</a>
          <a href="../9e7fc11a58e9fffb2ec1d6180c9de0c0c892c107/">Render `&lt;button&gt;` in `notes#new` template
</a>
          <a href="../5798e2c774e69291b66afc50d463b6cbbd864c56/">Render `&lt;form&gt;` element in `notes#new` template
</a>
          <a href="../addf71a423212a4b11ddb43edc2b0561d3025763/">Declare a `POST &#x2F;notes` route
</a>
          <a href="../39a75e308d2e763b76d7ed5be5920f01629ffc71/">Declare `notes#create` view template
</a>
          <a href="../b8c0fecb78d00b574aee7e2c69925a839232d6c6/">Render content from `params`
</a>
          <a href="../1f63746b78e57188128bdd704116f09e94565551/">Add `name=&quot;content&quot;` to `&lt;textarea&gt;`
</a>
          <a href="../7ba2a35e86e64e8776362ffb7ec4cea1f85f1b6f/">Enable Request Forgery Protection in `test`
</a>
          <a href="../f5b15516c5af779de2ef17f44af4234954b6ea48/">Use `form_tag` instead of `&lt;form&gt;`
</a>
          <a href="../02b98cfd4c0c554ec15692331f1cdd7688f6df3f/">Render `&lt;form&gt;` with `form_tag` with `form_with`
</a>
          <a href="../8281c9086bcb597f699547d01d7cd0059f871caf/">Build `&lt;textarea&gt;` with `text_area` helper
</a>
          <a href="../5fdde2290a4d77da5147ecab7a754d2a5ed69852/">Replace `&lt;label&gt;` with `#label` invocation
</a>
          <a href="../174971072d0de3fb3994dec664ae61a5bef0b123/">Replace `&lt;button&gt;` with `#submit` invocation
</a>
          <a href="../252c588bd353f96fb510756cc218f3ba6fc849c4/">Use named route in `notes#index`
</a>
          <a href="../3ec5b4f8260c2456a169fd906d86bc9371425f65/">Replace `&quot;&#x2F;notes&quot;` with `notes_path` invocation
</a>
          <a href="../c4680e04ea80231440ac0ec04ffdef3686819f01/">Replace `post`, `get` declarations with `resources`
</a>
          <a href="../3608c1de14ecc0048809c216bc21bcfdf6f89dd4/">Rename `get &quot;&#x2F;&quot;` route to &quot;root&quot;
</a>
          <a href="../5a65273e39b91c524624d6aa47c54b44f9ea9379/">Replace `get &quot;&#x2F;&quot;` declaration with `root`
</a>
          <a href="../bf1d3997add65349a5556ef730d676474647943e/">Drive system tests with Headless Chrome Browser
</a>
          <a href="../eb4aca5aebbf9d6d74f912c57714a0189694ec9a/">Complete the first TDD Red-Green-Refactor Cycle
</a>
          <a href="../181f78795b0ab95679e959880a7a43e8bcc6aa24/">Replace root with Redirect to `&#x2F;notes`
</a>
          <a href="../fdbbb4b2531aeb98cfbba24638ea5c4947995e2b/">Add failing system test
</a>
          <a href="../1788d9353a1e312612b5ee0f40c51be707e68dce/">Generate `Note` model
</a>
          <a href="../8528f6373cb17ddfc923d08a372b8c8494af0dc8/">Run the `create_notes` migration
</a>
          <a href="../178653d3ae51add50e836dcd83593a85f29f0f11/">Render a list of all `Note` records `notes#index`
</a>
          <a href="../20df2d1ba944f6561532bdc4a37c603cb262d993/">Render `notes#index` from controller action
</a>
          <a href="../4d49d6070bae25a19405f721f105eb266f608e80/">Introduce `NotesController` tests
</a>
          <a href="../0623c8864333f8d41040be774a046b35ab2f5d5b/">Disable CSRF-protection when in `test` environment
</a>
          <a href="../c260e2e9ef87e97d3c8ea78a5d19df8ea557ed1d/">Persist data in `POST &#x2F;notes` requests to `notes`
</a>
          <a href="../8d0c3dcde9e4ccd0e4e454142937cc31d171b685/">Redirect to `&#x2F;notes` after `POST &#x2F;notes` requests
</a>
          <a href="../1c632991e123dfd7b34cb7420fdc7b2028ed65f9/">Validate presence of `notes.content`
</a>
          <a href="../ad215bb6f0daedf41bab8577fefbdb419686406a/">Pass `model:` instead of `url:` in `notes#new`
</a>
          <a href="./" aria-current="page">Internationalize application&#x27;s text
</a>
          <a href="../899077a25b745c7699c187456d833e04383bad40/">Use `FormBuilder` to internationalize labels
</a>
      </nav>
    </details>

    <main class="page__content">
      <header>

        <nav class="navigation">

<a href="../ad215bb6f0daedf41bab8577fefbdb419686406a/">              &#8592; Previous
</a>
<a href="../899077a25b745c7699c187456d833e04383bad40/">              Next &#8594;
</a>        </nav>
      </header>

      <section class="container">
        <article class="container__item commit">
          <h1>Internationalize application&rsquo;s text</h1>

<p>When the <code>UserSharesAMessageTest</code> internationalizes the test step to
click on an <code>&lt;a&gt;</code> element that contains the text <code>Share a Note</code> with
<a href="https://github.com/ruby-i18n/i18n/tree/529b83a32036c210e4e35d49a2ac23e956cca67a#rails"><code>I18n.translate(&quot;notes.index.new&quot;)</code></a>, the following
error is raised:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Error:
UserSharesAMessageTest#test_visiting_the_index:
Capybara::ElementNotFound: Unable to find link or button "translation missing: en.notes.index.new"
    test/system/user_shares_a_message_test.rb:8:in `block in &lt;class:UserSharesAMessageTest&gt;'
</code></pre></div>
<p>The key, <code>notes.index.new</code> was selected intentionally. The <code>notes</code>
portion corresponds to the <code>notes</code> controller&rsquo;s internationalization
namespace. The <code>index</code> portion corresponds to the <code>NotesController</code>&lsquo;s
<code>index</code> action. The <code>new</code> portion is arbitrary, but represents the text
that will be rendered into an <code>&lt;a&gt;</code> element linking to the <code>notes#new</code>
route.</p>

<p>Capybara raises this error stating that the text <code>&quot;translation missing:
en.notes.index.new&quot;</code> is not present on the server-generated page. The
<code>en</code> portion prefixing the rest of the internationalization key is
derived from the request&rsquo;s current locale (i.e. English). This error is
not particularly helpful in driving our next code change: rendering
<code>&quot;translation missing: en.notes.index.new&quot;</code> on the page is not a desired
behavior.</p>

<p>The text <code>&quot;translation missing: en.notes.index.new&quot;</code> comes from <a href="https://guides.rubyonrails.org/i18n.html#abstracting-localized-code">Rails&rsquo;
flexible, forgiving default translation behavior</a> while in
<code>development</code> and <code>test</code> environments.</p>

<p>This commit changes that default behavior.</p>

<p>First, it replaces the test&rsquo;s call to <code>I18n.translate</code> with calls to
<code>ActionView::Helpers::TranslationHelper#translate</code>.</p>

<p>Next, by un-commenting the lines in <code>config/environments/test.rb</code> (and
<code>config/environments/development.rb</code> for test/development parity) and
ensuring that our test suite internationalizes text with the same
<a href="https://api.rubyonrails.org/v5.2/classes/ActionView/Helpers/TranslationHelper.html#method-i-translate"><code>translate</code> that <code>ActionView</code> uses</a>, a newer and
more helpful error message is raised:</p>
<div class="highlight"><pre class="highlight plaintext"><code>Error:
UserSharesAMessageTest#test_visiting_the_index:
I18n::MissingTranslationData: translation missing: en.notes.index.new
    test/system/user_shares_a_message_test.rb:8:in `block in &lt;class:UserSharesAMessageTest&gt;'
</code></pre></div>
<p>When that key is declared within the <code>config/locales/en.yml</code> file, the
test passes.</p>

<p>Finally, this commit replaces the <code>Share a Note</code> text that is hard-coded
in the <code>notes/index.html.erb</code> template with a call to <code>translate</code>.</p>

<p>By rendering <code>&lt;%= translate(&quot;.new&quot;) %&gt;</code> in the <code>notes#index</code> view
template, Rails will resolve the <code>.new</code> internationalization key
relative the current &ldquo;context&rdquo;, which is a request to <code>notes#index</code>.</p>

<p><a href="https://api.rubyonrails.org/classes/v5.2/ActionView/Helpers/TranslationHelper.html#method-i-translate">The context is translated into an internationalization scope</a>:
<code>notes.index</code>. This internationalization scope is prepended to the
relative <code>.new</code> key, which is then prepended with the current locale of
<code>en</code>.</p>

<p>This process generates a fully-qualified internationalization key of
<code>en.notes.index.new</code>, which corresponds to the translation we declared
in our test.</p>

        </article>
          <aside class="container__item diff">
              <details
  id="app/views/notes/index.html.erb"
  open
>
  <summary>
    app/views/notes/index.html.erb
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/notes/index.html.erb b/app/views/notes/index.html.erb
index 3720383..06df419 100644
</span><span class="gd">--- a/app/views/notes/index.html.erb
</span><span class="gi">+++ b/app/views/notes/index.html.erb
</span><span class="p">@@ -1,5 +1,5 @@</span>
 &lt;a href="&lt;%= new_note_path %&gt;"&gt;
<span class="gd">-  Share a Note
</span><span class="gi">+  &lt;%= translate(".new") %&gt;
</span> &lt;/a&gt;
 
 &lt;ul&gt;
</code></pre></div></details>

              <details
  id="config/environments/development.rb"
  open
>
  <summary>
    config/environments/development.rb
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/environments/development.rb b/config/environments/development.rb
index 66df51f..59c3fea 100644
</span><span class="gd">--- a/config/environments/development.rb
</span><span class="gi">+++ b/config/environments/development.rb
</span><span class="p">@@ -54,7 +54,7 @@</span> Rails.application.configure do
   config.assets.quiet = true
 
   # Raises error for missing translations.
<span class="gd">-  # config.action_view.raise_on_missing_translations = true
</span><span class="gi">+  config.action_view.raise_on_missing_translations = true
</span> 
   # Use an evented file watcher to asynchronously detect changes in source code,
   # routes, locales, etc. This feature depends on the listen gem.
</code></pre></div></details>

              <details
  id="config/environments/test.rb"
  open
>
  <summary>
    config/environments/test.rb
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/environments/test.rb b/config/environments/test.rb
index 1d62e91..38d436f 100644
</span><span class="gd">--- a/config/environments/test.rb
</span><span class="gi">+++ b/config/environments/test.rb
</span><span class="p">@@ -44,5 +44,5 @@</span> Rails.application.configure do
   config.active_support.deprecation = :stderr
 
   # Raises error for missing translations.
<span class="gd">-  # config.action_view.raise_on_missing_translations = true
</span><span class="gi">+  config.action_view.raise_on_missing_translations = true
</span> end
</code></pre></div></details>

              <details
  id="config/locales/en.yml"
  open
>
  <summary>
    config/locales/en.yml
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/locales/en.yml b/config/locales/en.yml
index cf9b342..4c1b4fd 100644
</span><span class="gd">--- a/config/locales/en.yml
</span><span class="gi">+++ b/config/locales/en.yml
</span><span class="p">@@ -30,4 +30,6 @@</span>
 # available at https://guides.rubyonrails.org/i18n.html.
 
 en:
<span class="gd">-  hello: "Hello world"
</span><span class="gi">+  notes:
+    index:
+      new: "Share a Note"
</span></code></pre></div></details>

              <details
  id="test/models/note_test.rb"
  open
>
  <summary>
    test/models/note_test.rb
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/models/note_test.rb b/test/models/note_test.rb
index 679348d..14bc08a 100644
</span><span class="gd">--- a/test/models/note_test.rb
</span><span class="gi">+++ b/test/models/note_test.rb
</span><span class="p">@@ -7,6 +7,6 @@</span> class NoteTest &lt; ActiveSupport::TestCase
     valid = note.validate
 
     assert_equal valid, false
<span class="gd">-    assert_equal note.errors[:content], [I18n.translate("errors.messages.blank")]
</span><span class="gi">+    assert_equal note.errors[:content], [translate("errors.messages.blank")]
</span>   end
 end
</code></pre></div></details>

              <details
  id="test/system/user_shares_a_message_test.rb"
  open
>
  <summary>
    test/system/user_shares_a_message_test.rb
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/user_shares_a_message_test.rb b/test/system/user_shares_a_message_test.rb
index f66c5b1..d6339f8 100644
</span><span class="gd">--- a/test/system/user_shares_a_message_test.rb
</span><span class="gi">+++ b/test/system/user_shares_a_message_test.rb
</span><span class="p">@@ -5,7 +5,7 @@</span> class UserSharesAMessageTest &lt; ApplicationSystemTestCase
     content = "Hello, World!"
 
     visit root_path
<span class="gd">-    click_on "Share a Note"
</span><span class="gi">+    click_on translate("notes.index.new")
</span>     fill_in "Message", with: content
     click_on "Share"
 
</code></pre></div></details>

              <details
  id="test/test_helper.rb"
  open
>
  <summary>
    test/test_helper.rb
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/test_helper.rb b/test/test_helper.rb
index d5300f8..f9ca081 100644
</span><span class="gd">--- a/test/test_helper.rb
</span><span class="gi">+++ b/test/test_helper.rb
</span><span class="p">@@ -3,6 +3,8 @@</span> require_relative '../config/environment'
 require 'rails/test_help'
 
 class ActiveSupport::TestCase
<span class="gi">+  include ActionView::Helpers::TranslationHelper
+
</span>   # Run tests in parallel with specified workers
   parallelize(workers: :number_of_processors)
 
</code></pre></div></details>

          </aside>
      </section>
    </main>
  </body>
</html>
